_ubupdate=sf probe; sf update ${fileaddr} 0 ${filesize}

ubupdate=set filesize=a000; run _ubupdate

mmcaddr=66000000
mmc_cur=1
mmc_bak=2
mmc_dev=mmc 0
mmc_image=new.ext4.gz

mmc_swap=env set mmc_cur ${mmc_bak};
	env save

mmc_dlup=dhcp ${mmc_image};
	unzip ${fileaddr} ${mmcaddr};
	run mmc_update

mmc_set_blkcnt=setexpr mmc_blkcnt ${filesize} + 0x1ff &&
	setexpr mmc_blkcnt ${mmc_blkcnt} / 0x200

mmc_update=run mmcgetoffset;
	run mmc_set_blkcnt;
	mmc write ${mmcaddr} ${mmc_start} ${mmc_blkcnt}

mmc_boot=run mmc_tryboot;
	env set mmc_cur ${mmc_bak};
	run mmc_tryboot

mmc_tryboot=run mmcload;
	setenv mtdroot root_next=/dev/mmcblk0p${mmc_cur};
	run ramboot

mmcgetoffset=part start ${mmc_dev} ${mmc_cur} mmc_start

mmcload=ext4load ${mmc_dev}:${mmc_cur} ${loadaddr} Image.itb

mmc_part=uuid_disk=${mmc_guid};
	name=Boot0,size=1024MiB,type=linux;
	name=Boot1,size=1024MiB,type=linux;
	name=Data,size=1536MiB,type=linux
